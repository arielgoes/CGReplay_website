<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Quality Evaluation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .welcome-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
        .user-id-display {
            font-family: monospace;
            font-size: 18px;
            padding: 8px 16px;
            background-color: #f0f0f0;
            border-radius: 4px;
            display: inline-block;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .evaluation-section {
            display: none;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .video-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .video-box {
            flex: 1;
            min-width: 300px;
        }
        .video-box video {
            width: 100%;
            border-radius: 4px;
        }
        .rating-section {
            margin-top: 20px;
        }
        .rating-box {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        .rating-stars {
            display: flex;
            justify-content: space-between;
            max-width: 250px;
            margin: 10px 0;
        }
        .star {
            cursor: pointer;
            font-size: 24px;
            color: #ccc;
        }
        .star.selected {
            color: #ffd700;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        .thank-you {
            display: none;
            text-align: center;
            padding: 40px;
            font-size: 24px;
            color: #4CAF50;
        }
        .progress {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Video Quality Evaluation</h1>
        <p>Please evaluate the visual quality of each video pair using a 1-5 scale</p>
    </div>

    <div class="welcome-section" id="welcomeSection">
        <h2>Welcome to the Video Quality Evaluation</h2>
        <p>Your unique participant ID is:</p>
        <div class="user-id-display" id="userIdDisplay">GENERATING...</div>
        <p>Please note this ID for your records. You'll need it if you want to reference your evaluation later.</p>
        <button id="startButton">Start Evaluation</button>
    </div>

    <div class="evaluation-section" id="evaluationSection">
        <div class="progress" id="progress"></div>
        <h2 id="sceneTitle">Scene Evaluation</h2>
        
        <div class="video-container">
            <div class="video-box">
                <h3>Video A</h3>
                <video id="videoA" controls></video>
                <div class="rating-box">
                    <label>Rate Video A (1-5):</label>
                    <div class="rating-stars" id="starsA">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <textarea id="commentA" placeholder="Optional comment for Video A"></textarea>
                </div>
            </div>
            
            <div class="video-box">
                <h3>Video B</h3>
                <video id="videoB" controls></video>
                <div class="rating-box">
                    <label>Rate Video B (1-5):</label>
                    <div class="rating-stars" id="starsB">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <textarea id="commentB" placeholder="Optional comment for Video B"></textarea>
                </div>
            </div>
        </div>
        
        <button id="submitButton" disabled>Submit Ratings</button>
    </div>

    <div class="thank-you" id="thankYouSection">
        <h2>Thank You!</h2>
        <p>Your evaluation has been successfully recorded.</p>
        <p>Your participant ID: <span id="thankYouUserId"></span></p>
    </div>

    <script>
        // Configuration 
        const videoPairs = [
            {real: "videos/original_video.mp4", synth: "videos/interpolated_video_addWeighted.mp4"},
            {real: "videos/original_video_1280_720.mp4", synth: "videos/interpolated_video_film.mp4"},
            // Add more pairs as needed
        ];
        
        // Google Sheet script URL (you'll need to replace this with your actual script URL)
        const SCRIPT_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID_HERE/exec";
        
        // Variables
        let currentPairIndex = 0;
        let userId = generateRandomUserId(10);
        let ratingA = 0;
        let ratingB = 0;
        let resultsData = [];
        
        // DOM Elements
        const welcomeSection = document.getElementById("welcomeSection");
        const evaluationSection = document.getElementById("evaluationSection");
        const thankYouSection = document.getElementById("thankYouSection");
        const userIdDisplay = document.getElementById("userIdDisplay");
        const thankYouUserId = document.getElementById("thankYouUserId");
        const startButton = document.getElementById("startButton");
        const submitButton = document.getElementById("submitButton");
        const progressIndicator = document.getElementById("progress");
        const sceneTitle = document.getElementById("sceneTitle");
        const videoA = document.getElementById("videoA");
        const videoB = document.getElementById("videoB");
        const commentA = document.getElementById("commentA");
        const commentB = document.getElementById("commentB");
        const starsA = document.getElementById("starsA");
        const starsB = document.getElementById("starsB");
        
        // Display the generated user ID
        userIdDisplay.textContent = userId;
        thankYouUserId.textContent = userId;
        
        // Event Listeners
        startButton.addEventListener("click", startEvaluation);
        submitButton.addEventListener("click", submitRatings);
        
        // Setup star rating for both videos
        setupStarRating(starsA, (value) => {
            ratingA = value;
            checkSubmitButton();
        });
        
        setupStarRating(starsB, (value) => {
            ratingB = value;
            checkSubmitButton();
        });
        
        // Functions
        function generateRandomUserId(length) {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }
        
        function setupStarRating(container, callback) {
            const stars = container.querySelectorAll(".star");
            
            stars.forEach(star => {
                star.addEventListener("click", function() {
                    const value = parseInt(this.getAttribute("data-value"));
                    
                    // Reset all stars
                    stars.forEach(s => s.classList.remove("selected"));
                    
                    // Select clicked star and all stars before it
                    for (let i = 0; i < stars.length; i++) {
                        const s = stars[i];
                        if (parseInt(s.getAttribute("data-value")) <= value) {
                            s.classList.add("selected");
                        }
                    }
                    
                    callback(value);
                });
            });
        }
        
        function startEvaluation() {
            welcomeSection.style.display = "none";
            evaluationSection.style.display = "block";
            
            loadCurrentPair();
        }
        
        function loadCurrentPair() {
            if (currentPairIndex >= videoPairs.length) {
                finishEvaluation();
                return;
            }
            
            // Update progress indicator
            progressIndicator.textContent = `Scene ${currentPairIndex + 1} of ${videoPairs.length}`;
            
            // Get current video pair
            const currentPair = videoPairs[currentPairIndex];
            const sceneName = currentPair.real.split('_real')[0];
            
            // Set scene title
            sceneTitle.textContent = `Evaluate ${sceneName}`;
            
            // Randomize which video is A and which is B
            const isARealVideo = Math.random() >= 0.5;
            
            // Set video sources
            videoA.src = isARealVideo ? currentPair.real : currentPair.synth;
            videoB.src = isARealVideo ? currentPair.synth : currentPair.real;
            
            // Store which video is real for data collection
            videoA.dataset.isReal = isARealVideo;
            videoB.dataset.isReal = !isARealVideo;
            videoA.dataset.filename = isARealVideo ? currentPair.real : currentPair.synth;
            videoB.dataset.filename = isARealVideo ? currentPair.synth : currentPair.real;
            
            // Reset ratings and comments
            resetRatings();
            
            // Load videos
            videoA.load();
            videoB.load();
        }
        
        function resetRatings() {
            // Reset star ratings
            document.querySelectorAll(".star").forEach(star => {
                star.classList.remove("selected");
            });
            
            // Reset comment fields
            commentA.value = "";
            commentB.value = "";
            
            // Reset rating values
            ratingA = 0;
            ratingB = 0;
            
            // Disable submit button
            submitButton.disabled = true;
        }
        
        function checkSubmitButton() {
            // Enable submit button only when both videos have been rated
            submitButton.disabled = !(ratingA > 0 && ratingB > 0);
        }
        
        function submitRatings() {
            // Get current scene name
            const currentPair = videoPairs[currentPairIndex];
            const sceneName = currentPair.real.split('_real')[0];
            
            // Collect data
            const resultData = {
                user_id: userId,
                scene: sceneName,
                video_A_filename: videoA.dataset.filename,
                video_B_filename: videoB.dataset.filename,
                A_score: ratingA,
                B_score: ratingB,
                A_comment: commentA.value.trim() || "N/A",
                B_comment: commentB.value.trim() || "N/A",
                video_A_is_real: videoA.dataset.isReal === "true",
                video_B_is_real: videoB.dataset.isReal === "true",
                timestamp: new Date().toISOString()
            };
            
            // Add to results array
            resultsData.push(resultData);
            
            // Submit data to Google Sheets
            submitToGoogleSheets(resultData);
            
            // Move to next pair
            currentPairIndex++;
            loadCurrentPair();
        }
        
        function submitToGoogleSheets(data) {
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .catch(error => console.error('Error submitting data:', error));
        }
        
        function finishEvaluation() {
            evaluationSection.style.display = "none";
            thankYouSection.style.display = "block";
        }
    </script>
</body>
</html>
